<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link href="https://fonts.googleapis.com/css2?family=Dongle&family=Gamja+Flower&family=Nanum+Myeongjo&family=Nanum+Pen+Script&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<style type="text/css">
  .box{
    width: 30px;
    height: 30px;
    border-radius: 100px;
    border: 1px solid gray;
  }

</style>
<script type="text/javascript">
  $(function(){
	  
	  //처음시작하자마자 리스트
	  comment_list();
	  
  });
  
  function comment_list()
  {
	  let num=[[${dto.num}]];
 	  //alert(num);
 	  
 	  $.ajax({
 		  type:"get",
 		  dataType:"json",
 		  url:"commentlist",
 		  data:{"num":num},
 		  success:function(res){
 			  
 			  let s=`댓글 &nbsp;&nbsp;${res.length}개`;
 			  
 			  $.each(res,function(idx,item){
 				  s+=
 					  `
 					  <div style="margin-left:20px;">${item.comment}
 					    <span style="color:gray; font-size:0.9em;">${item.writeday}</span>
 					  </div>
 					  `
 			  })

 			  $(".comment-list").html(s);
 		  }
 	  })

  }
</script>
</head>
<body>
<div style="margin: 100px 100px;">
   <h2>[[${dto.carname}]]</h2><br><br>
   <img th:src="@{|/carsave/${dto.carphoto}|}" style="width: 500px;">
   
   <h4>색상: <div class="box" th:style="'background-color: '+${dto.carcolor}"></div></h4>
   <h4>가격: <span th:text="${#numbers.formatInteger(dto.carprice,0,'COMMA')}"></h4>
   <h4>구입일: [[${dto.carguip}]]</h4>
   <h4>등록날짜: <span th:text="${#calendars.format(dto.writeday,'yyyy-MM-dd HH:mm')}"></span></h4>
   <br><br>
   
   <!-- 댓글부분 여기부터.... -->
   <hr>
   <div class="comment-list">
      댓글목록
   </div>
   <div class="d-flex">
      <input type="text" class="form-control" id="comment"
      placeholder="댓글을 입력하시오" style="width: 450px;">
      <button type="button" class="btn btn-info btn-sm" id="btncomment">저장</button>
      <br><br>
   </div>
   
   <!--댓글추가이벤트  -->
   <script type="text/javascript">
     $("#btncomment").click(function(){
    	 let num=[[${dto.num}]];
    	 //alert(num);
    	 let comment=$("#comment").val();
    	 //alert(comment);
    	 
    	 $.ajax({
    		 type:"get",
    		 dataType:"html",
    		 url:"/addcomment",
    		 data:{"num":num,"comment":comment},
    		 success:function(){
    			 
    			 //alert("성공");
    			 //댓글출력
    			 comment_list();
    			 
    			 
    			 $("#comment").val('');
    			 
    		 }
    	 })
    	 
     })
   </script>
   
   <button type="button" class="btn btn-outline-primary"
   onclick="location.href='/list'">목록</button>
   <button type="button" class="btn btn-outline-primary"
   onclick="location.href='/addcar'">글쓰기</button>
   <button type="button" class="btn btn-outline-primary"
   th:onclick="|location.href='@{/delete(num=${dto.num})}'|">삭제</button>
   <button type="button" class="btn btn-outline-primary"
   th:onclick="|location.href='@{/updateform(num=${dto.num})}'|">수정</button>
</div>
</body>
</html>